<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="/daummap/css/map.css" />
<link rel="stylesheet" href="/daummap/css/jquery.simplebanner.css" />
<link rel="stylesheet" href="/daummap/js/jui/dist/jui.min.css" />
<link rel="stylesheet" href="/daummap/js/jui/dist/jennifer.theme.min.css" />
<script type="text/javascript" src="/daummap/js/jquery-1.11.3.min.js"></script>
<script type="text/javascript"	src="/daummap/js/jquery.simplebanner.js"></script>
<script type="text/javascript" src="/daummap/js/jui/dist/jui.min.js"></script>
<script type="text/javascript" src="/daummap/js/jui/js/base.js"></script>
<script type="text/javascript" src="/daummap/js/jui/js/core.js"></script>
<script type="text/javascript" src="/daummap/js/jui/js/ui/modal.js"></script>
<script type="text/javascript" src="/daummap/js/jui/js/uix/tree.js"></script>
<script type="text/javascript" src="/daummap/js/jui/js/uix/window.js"></script>
<script type="text/javascript"
	src="//apis.daum.net/maps/maps3.js?apikey=5f101424c141ce53e3ed5e26f10ca225&libraries=services"></script>
<title>수원 서부 경찰서 EM</title>
</head>
<body class="jui" style="height: 630px;">
	<!-- 로딩이미지 레이어 -->
	<div class="wrap-loading display-none">
		<div>
			<img src="/daummap/images/loading.gif" />
		</div>
	</div>
	<!-- 탭 -->
	<ul class="tab top">
		<li class="active"><a href="#"><i class="icon-home"></i> 시설맵</a>
		</li>
		<li><a href="#"><i class="icon-gear"></i> 관리페이지</a></li>
	</ul>
	<!-- Main panel -->
	<div class="panel">
		<div class="head">
			<div class="left">수원 서부 경찰서 EM</div>
			<div class="right" style="position: absolute; right: 3px; top: 0px;">
				<a href="#" class="btn" onclick="hideMarkers();return false;">모든 Marker 삭제 <i class="icon-trashcan"></i></a>
				<a href="#" class="btn" onclick="setMarkers(map);return false;">모든 Marker 배치 <i class="icon-refresh"></i></a>
			</div>
		</div>
		<div class="body">
			<div class="row">
				<div class="col col-2" style="max-height: 630px; overflow: auto;">
					<ul class="tree line-file"></ul>
				</div>
				<div class="col col-10">
					<div id="container">
						<div id="rvWrapper">
							<div id="roadview" style="width: 100%; height: 100%;"></div>
							<!-- 로드뷰를 표시할 div 입니다 -->
							<div id="close" title="로드뷰닫기" onclick="closeRoadview()">
								<span class="img"></span>
							</div>
						</div>
						<div id="mapWrapper">
							<div id="map" style="width: 100%; height: 100%"></div>
							<!-- 지도를 표시할 div 입니다 -->
							<div id="roadviewControl" onclick="setRoadviewRoad()">
								<span>로드뷰</span>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
		<!-- 시설정보 window -->
		<div id="mapInfo" class="window">
		<div class="head">
			<div class="left">
				<span id="mapName"></span>
			</div>
			<div class="right">
				<a href="javascript:panTo(office_tree.activeIndex()).data.lat,office_tree.get(office_tree.activeIndex()).data.lng);return false;"><i class="icon-search"></i></a> <a href="#"
					class="close"><i class="icon-exit"></i></a>
			</div>
		</div>
		<div class="body">
			<div>
				<span class="label">주소</span><span id="mapAddr"></span>
			</div>
			<div>
				<span class="label">전화번호</span><span id="mapPhon"></span>
			</div>
			<div>
				<span class="label">CCTV정보</span><span id="mapCctv"></span>
			</div>
			<div id="cctvList"></div>
		</div>
	</div>


		<script id="tpl_node" type="text/template">
    <li>
        <div><i></i> <!= name !> </div>
        <ul></ul>
    </li>
	</script>
<script type="text/javascript" src="/daummap/js/map.js"></script>
<script type="text/javascript">
jui.ready([ "uix.window" ], function(win) {
	    mapInfo = win("#mapInfo", {
		width : 600,
		height : 550,
		modal : true
	    });
	});
	jui.ready([ "uix.tree" ], function(tree) {
	    office_tree = tree(".tree", {
		root : {
		    name : "시설정보"
		},
		event : {
		    select : function(node) {
			/* this.select(node.index);
			alert("index(" + node.index + "), title("
					+ node.data.title + ")"); */
			this.select(node.index);
			if (node.depth > 1) {
			    $('#mapName').text(node.data.name);
			    $('#mapAddr').text(node.data.addr);
			    $('#mapPhon').text(node.data.phon);
			    $('#cctvList').html('');
			    var cctvList = node.data.cctvList;
			    if (cctvList.length > 0) {
				var html = '<div id="siteWpr">';
				html += '<div class="simpleBanner">';
				html += '<div class="bannerListWpr">';
				html += '<ul class="bannerList">';
				for (var i = 0; i < cctvList.length; i++) {
				    var cctv = cctvList[i];
				    html += '<li><img src="/daummap' + cctv.imgpath + '" ></li>';
				}
				html += '</ul>';
				html += '</div>';
				html += '<div class="bannerControlsWpr bannerControlsPrev"><div class="bannerControls"></div></div>';
				html += '<div class="bannerIndicators"><ul></ul></div>';
				html += '<div class="bannerControlsWpr bannerControlsNext"><div class="bannerControls"></div></div>';
				html += '</div>';
				html += '</div>';
				$('#cctvList').html(html);
				$('.simpleBanner').simplebanner({
				    autoRotate : false
				});
				$('#cctvList').show();
			    } else {
				$('#mapCctv').text("CCTV 정보 없음.");
				$('#cctvList').hide();
			    }
			    mapInfo.show();
			}
		    }
		},
		tpl : {
		    node : $("#tpl_node").html()
		}
	    });
	   getMapInfoList();
	});

	function getMapInfoList() {
	    $.ajax({
		url : "/daummap/mapCodeList.json",
		cache : false,
		beforeSend : function() {
		    $('.wrap-loading').removeClass('display-none');
		},
		success : function(datas) {
		    var mapInfoList = datas.mapInfoList;
		    for (var i = 0; i < mapInfoList.length; i++) {
			var mapCode = mapInfoList[i];
			var mapList = mapCode.mapList;
			office_tree.append(mapCode);
			for (var j = 0; j < mapList.length; j++) {
			    var map = mapList[j];
			    office_tree.append(i, map);
				crateMarker(map.lat, map.lng, mapCode.imgpath);
			}
			office_tree.fold(i);
		    }
		},
		error : function(r, e, o) {
		    alert('mapCodeList.do 수행중 에러');
		    console.log(r);
		    console.log(e);
		    console.log(o);
		},
		complete : function() {
		    $('.wrap-loading').addClass('display-none');
		}
	    });
	}
</script>
</body>
</html>
